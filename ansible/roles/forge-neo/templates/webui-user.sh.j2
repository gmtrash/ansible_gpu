#!/bin/bash
# Forge Neo Launch Configuration
# Optimized for NVIDIA Blackwell GPUs (RTX 5060 Ti)
# Generated by Ansible

# Python executable
export PYTHON_CMD="python3"

# Command line arguments
export COMMANDLINE_ARGS="--sage --disable-flash --cuda-malloc --listen --port 7860 --skip-install"

# Explanation of flags:
# --sage              : Use SageAttention 2 (optimized for Blackwell architecture)
# --disable-flash     : Disable FlashAttention (SageAttention takes priority)
# --cuda-malloc       : CUDA memory optimization
# --listen            : Allow network access (0.0.0.0)
# --port 7860         : Default port
# --skip-install      : Skip automatic package installation (already done by Ansible)

# Optional: Uncomment to enable experimental features (may cause issues)
# export COMMANDLINE_ARGS="${COMMANDLINE_ARGS} --cuda-stream"
# export COMMANDLINE_ARGS="${COMMANDLINE_ARGS} --pin-shared-memory"

# Optional: Low VRAM mode (uncomment if running out of memory)
# export COMMANDLINE_ARGS="${COMMANDLINE_ARGS} --always-low-vram"

# Launch
cd "{{ forge_install_dir }}/app"
source venv/bin/activate
python3 webui.py ${COMMANDLINE_ARGS}
